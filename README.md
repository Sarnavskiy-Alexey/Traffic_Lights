# Тестовое задание

## Тема: "Разработка адаптивного алгоритма работы светофора"

### Описание

Адаптивный алгоритм работы светофоров призван оптимизировать общую пропускную способность перекрестка в зависимости от ситуации на перекрестке.

Для тестирования программы используется перекресток с 12 светофорами: 4 автомобильных и 8 пешеходных (по 1 с каждой стороны дороги для перехода на соседнюю сторону). Для автомобилей организовано движение по одной полосе в каждую сторону.

Автомобили пересекают перекресток либо в прямом направлении, либо с поворотом направо.

### Алгоритм работы

Светофоры на перекрестке являются самостоятельными, т.е. внешний интегратор отсутствует.

Для синхронизации светофоров используется внешняя функция, позволяющая передавать события от одного светофора остальным. Такой функцией может выступать, например, функция передачи по каким-либо интерфейсам: A429, A664 (AFDX), A825 (CAN) и т.п. Для симуляции разработана функция, перекладывающая сообщение от одного светофора другим.

В сообщении указывается идентификатор светофора-отправителя, количество объектов, находящихся в ожидании проезда светофора, и текущее состояние светофора (зеленый, желтый или красный).

Общий алгоритм изменения состояний каждого светофора следующий:

```
ЕСЛИ в очереди текущего светофора есть объекты
ТО
    ЕСЛИ текущее состояние зеленый
    ТО
        ЕСЛИ среди светофоров_X есть зеленые ИЛИ
        (
          [
            среди светофоров_X есть те, которые ожидают зеленого дольше текущего и таймер ожидания красного превышен, ИЛИ
            среди светофоров_X есть те, у которых ожидающих в очереди больше, чем у текущего
          ] И
          зеленое состояние дольше минимального
        )
        ТО выполняется процедура перевода состояния в красный
        ИНАЧЕ нет действий
    ИНАЧЕ ЕСЛИ текущее состояние желтый И предыдущее состояние зеленый
    ТО выполняется процедура перевода состояния в красный
    ИНАЧЕ ЕСЛИ текущее состояние красный
    ТО
        ЕСЛИ превышено ожидание зеленого
        ТО
            ЕСЛИ среди светофоров_X нет тех, которые ожидают зеленого дольше текущего
            ТО
                ЕСЛИ среди светофоров_X нет желтого или зеленого
                ТО выполняется процедура перевода состояния в зеленый
                ИНАЧЕ выполняется процедура перевода состояния в красный
            ИНАЧЕ нет действий
        ИНАЧЕ ЕСЛИ среди остальных светофоров нет тех, у которых в очереди ожидающих больше, чем у текущего
        ТО
            ЕСЛИ среди светофоров_X нет желтого или зеленого
            ТО выполняется процедура перевода состояния в зеленый
            ИНАЧЕ выполняется процедура перевода состояния в красный
    ИНАЧЕ ЕСЛИ текущее состояние желтый И предыдущее состояние красный
    ТО
        ЕСЛИ среди светофоров_X нет желтого или зеленого
        ТО выполняется процедура перевода состояния в зеленый
        ИНАЧЕ выполняется процедура перевода состояния в красный
    ИНАЧЕ нет действий
ИНАЧЕ выполняется процедура перевода состояния в красный
```

где под ___светофоры_X___ подразумеваются те светофоры, которые _не могут_ быть в зеленом состоянии одновременно с текущим светофором.

Также в программе присутствует определение светофоров, которые _могут_ быть в зеленом состоянии одновременно с текущим светофором.

Перевод состояния в красный для автомобильных светофоров выполняется следующим образом: если текущее состояние зеленый, то перевести в желтый, а если текущее состояние желтый, то перевести в красный. Таким образом, на одном такте нет возможности выполнить перевод из зеленого в красный. Аналогично происходит перевод из красного в зеленый.

Согласно разработанному алгоритму возможен случай, когда светофор переводится из красного в желтый, но далее возвращается в зеленый. Такое возможно, если два или более светофоров начали процедуру перевода в зеленый одновременно.

Для моделирования реального перекрестка эти "промежуточные" состояния не должны обрабатываться самим светофором. Желательно использовать некоторые задержки, чтобы алгоритм мог успеть обработать состояния.

Список обозначенных выше светофоров задается перед запуском "перекрестка". Это важно для того, чтобы каждый светофор "видел" состояние других светоров и подстраивался под них таким образом, чтобы не нарушать безопасность дорожного движения. Пример нарушения БДД: одновременная перестановка зеленого состояния у автомобильного светофора и того пешеходного, который пересекает маршрут движения автомобилей.

### Используемые технологии

|№<br>п/п|Параметр|Версия|
|:-:|:-|:-|
|1|Целевые ОС|Windows 10, Windows 11|
|2|Компилятор|GCC 13.2.0 (Rev6, Built by MSYS2 project)|
|3|Средство сборки|cmake версии 3.30.0-rc4|
|3|IDE|Visual Studio Code версии 1.91.1|
|4|СКВ|Git version 2.45.2.windows.1|
|5|C/C++ Extansion Pack|Идентификатор: [ms-vscode.cpptools-extension-pack](https://marketplace.visualstudio.com/items?itemName=ms-vscode.cpptools-extension-pack "C/C++ Extansion Pack - VS Code")<br>Версия: 1.3.0|
|6|CMake Tools|Идентификатор: [ms-vscode.cmake-tools](https://marketplace.visualstudio.com/items?itemName=ms-vscode.cmake-tools "CMake Tools - VS Code")<br>Версия: 1.18.43|
|7|Google Test|[Библиотека](https://github.com/google/googletest/archive/refs/tags/release-1.12.1.zip "Google Test - GitHub") версии 1.12.1|

### Краткая инструкция пользователю

#### Проверка
Перед запуском проекта проверьте следующее:
- установлен GCC версии 13.2.0 (остальные версии GCC не тестировались);
- путь к _gcc.exe_ прописан в системных переменных среды;
- установлен cmake версии 3.30.0 (остальные версии cmake не тестировались)
- путь к _cmake.exe_ прописан в системных переменных среды;
- имеется доступ в сеть Интернет для загрузки библиотеки GTest либо данная библиотека уже подгружена в нужную директорию.

#### Запуск
Для запуска проекта необходимо выполнить конфигурацию CMake файла CMakeLists.txt, находящегося в корне рабочего пространства, далее выполнить сборку основного (```traffic_lights```) или тестового (```traffic_lights_test```) приложения и после этого запустить исполняемый файл.
